// scripts.min.js

// Smooth fade-in effect for sections
document.addEventListener("DOMContentLoaded", () => {
  const faders = document.querySelectorAll(".fade-in");
  const observer = new IntersectionObserver(
    entries => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add("visible");
        }
      });
    },
    { threshold: 0.1 }
  );
  faders.forEach(fader => observer.observe(fader));

  // Set current year in footer
  const yearSpan = document.getElementById("year");
  if (yearSpan) yearSpan.textContent = new Date().getFullYear();

  // Load dynamic assets
  loadAsset("headshot", "img", "headshot");
  loadAsset("cv", "a", "cv-download-link", ["cv-download-link-secondary"]);
  loadAsset("video", "video", "introVideo");
});

// Generic asset loader
async function loadAsset(type, elementTag, elementId, additionalIds = []) {
  try {
    const res = await fetch(`/api/get-latest?type=${type}`);
    const data = await res.json();
    if (!data.url) throw new Error("No URL returned");

    // Main element
    const el = document.getElementById(elementId);
    if (el) {
      if (elementTag === "img") el.src = data.url;
      if (elementTag === "a") el.href = data.url;
      if (elementTag === "video") {
        const source = el.querySelector("source");
        if (source) source.src = data.url;
        el.load();
      }
    }

    // Additional elements (e.g., multiple CV links)
    additionalIds.forEach(id => {
      const additionalEl = document.getElementById(id);
      if (additionalEl && elementTag === "a") additionalEl.href = data.url;
    });

  } catch (err) {
    console.error(`Failed to load ${type}:`, err);
  }
}
